name: libinput
buildsystem: meson
config-opts:
  - --libexec=lib
  - -Dlibwacom=false
  - -Ddebug-gui=false
  - -Dtests=false
  - -Ddocumentation=false
  - -Dzshcompletiondir=no
sources:
  - type: archive
    url: https://gitlab.freedesktop.org/libinput/libinput/-/archive/1.30.901/libinput-1.30.901.tar.gz
    sha256: 0717ca2227a03efbbc6ac5d1c0bd3410e2501d895c2e3753cb439faf4261b59f
    x-checker-data:
      type: json
      url: https://gitlab.freedesktop.org/api/v4/projects/libinput%2Flibinput/releases
      version-query: first | .tag_name
      url-query: '"https://gitlab.freedesktop.org/libinput/libinput/-/archive/" +
        $version + "/libinput-" + $version + ".tar.gz"'
cleanup:
  - /bin
  - /etc
  - /lib/libinput
  - /lib/udev
  - /share
  - /include
  - /lib/pkgconfig
modules:
  - name: mtdev
    buildsystem: autotools
    config-opts:
      - --disable-static
    sources:
      - type: archive
        url: https://bitmath.se/org/code/mtdev/mtdev-1.1.7.tar.bz2
        sha256: a107adad2101fecac54ac7f9f0e0a0dd155d954193da55c2340c97f2ff1d814e
        x-checker-data:
          type: html
          url: https://bitmath.se/org/code/mtdev/
          version-pattern: mtdev-([\d.]+)\.tar\.bz2
          url-template: https://bitmath.se/org/code/mtdev/mtdev-$version.tar.bz2
      # Upstream uses an outdated version of the config.guess/config.sub script,
      # so we override it here to fix aarch64 builds.
      - type: shell
        commands:
          - cp -p /usr/share/automake-*/config.{sub,guess} config-aux/
    cleanup:
      - /bin
      - /include
      - /lib/*.la
      - /lib/pkgconfig
